<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Notes</title>
<script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>

<style>
:root {
    --bg:#ece5dd; --header:#075e54; --me:#dcf8c6;
    --other:#fff; --text:#000; --input:#f0f0f0;
}
body.dark {
    --bg:#121212; --header:#1f1f1f; --me:#054640;
    --other:#2a2a2a; --text:#fff; --input:#1f1f1f;
}
body {
    margin:0; background:var(--bg); color:var(--text);
    font-family:Arial; height:100vh;
    display:flex; flex-direction:column;
}
header {
    background:var(--header); color:white;
    padding:10px; display:flex;
    justify-content:space-between;
}
#chat {
    flex:1; overflow-y:auto;
    padding:10px; padding-bottom:80px;
    display:flex; flex-direction:column;
}
.message {
    max-width:75%; margin-bottom:8px;
    padding:8px 12px; border-radius:8px;
}
.me { background:var(--me); align-self:flex-end; }
.other { background:var(--other); align-self:flex-start; }

footer {
    position:fixed; bottom:0; left:0; right:0;
    display:flex; padding:8px;
    background:var(--input);
}
input {
    flex:1; padding:10px; border-radius:20px;
    border:none; outline:none;
}
button {
    margin-left:6px; border:none;
    background:var(--header);
    color:white; border-radius:50%;
    padding:10px;
}
.theme { background:none; }
</style>
</head>

<body>
<header>
    <span>Notes</span>
    <div>
        <button class="theme" onclick="toggleTheme()">ðŸŒ™</button>
        <button class="theme" onclick="panic()">ðŸš¨</button>
    </div>
</header>

<div id="chat"></div>

<footer>
    <button onclick="pickFile()">ðŸ“Ž</button>
    <input id="msg" placeholder="Type a message">
    <button onclick="sendMsg()">âž¤</button>
</footer>

<input type="file" id="file" hidden accept="image/*,audio/*">

<script>
const socket = io();
const chat = document.getElementById("chat");
const file = document.getElementById("file");

if (localStorage.theme === "dark") {
    document.body.classList.add("dark");
}

socket.on("message", msg => {
    const div = document.createElement("div");
    div.classList.add("message");

    if (msg.startsWith("FILE:")) {
        const data = msg.replace("FILE:","");
        if (data.startsWith("data:image"))
            div.innerHTML = `<img src="${data}" style="max-width:200px;border-radius:8px">`;
        else
            div.innerHTML = `<audio controls src="${data}"></audio>`;
        div.classList.add("other");
    } else {
        const text = msg.replace(/(https?:\/\/\S+)/g,
            '<a href="$1" target="_blank">$1</a>');
        if (msg.startsWith("me:")) {
            div.classList.add("me");
            div.innerHTML = text.replace("me:","");
        } else {
            div.classList.add("other");
            div.innerHTML = text;
        }
    }

    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
});

function sendMsg() {
    const i = document.getElementById("msg");
    if (i.value.trim()) {
        socket.send("me: " + i.value);
        i.value = "";
    }
}

function toggleTheme() {
    document.body.classList.toggle("dark");
    localStorage.theme =
        document.body.classList.contains("dark") ? "dark" : "light";
}

function panic() {
    socket.disconnect();
    chat.innerHTML = "";
    localStorage.clear();
    location.reload();
}

function pickFile() {
    file.click();
}

file.onchange = () => {
    const f = file.files[0];
    if (!f) return;
    const r = new FileReader();
    r.onload = () => socket.send("FILE:" + r.result);
    r.readAsDataURL(f);
};
</script>
</body>
</html>
